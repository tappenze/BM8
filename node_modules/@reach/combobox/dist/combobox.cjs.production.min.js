"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");require("prop-types");var t,n,a,r,o,i=require("@reach/utils"),u=require("@reach/descendants"),l=require("highlight-words-core"),c=require("@reach/auto-id"),s=require("@reach/popover");function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function d(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t.indexOf(n=o[a])>=0||(r[n]=e[n]);return r}var f="IDLE",E="SUGGESTING",p="NAVIGATING",C="INTERACTING",b={initial:f,states:(o={},o.IDLE={on:(t={},t.BLUR=f,t.CLEAR=f,t.CHANGE=E,t.INITIAL_CHANGE=f,t.FOCUS=E,t.NAVIGATE=p,t.OPEN_WITH_BUTTON=E,t)},o[E]={on:(n={},n.CHANGE=E,n.FOCUS=E,n.NAVIGATE=p,n.CLEAR=f,n.ESCAPE=f,n.BLUR=f,n.SELECT_WITH_CLICK=f,n.INTERACT=C,n.CLOSE_WITH_BUTTON=f,n)},o[p]={on:(a={},a.CHANGE=E,a.FOCUS=E,a.CLEAR=f,a.BLUR=f,a.ESCAPE=f,a.NAVIGATE=p,a.SELECT_WITH_CLICK=f,a.SELECT_WITH_KEYBOARD=f,a.CLOSE_WITH_BUTTON=f,a.INTERACT=C,a)},o[C]={on:(r={},r.CLEAR=f,r.CHANGE=E,r.FOCUS=E,r.BLUR=f,r.ESCAPE=f,r.NAVIGATE=p,r.CLOSE_WITH_BUTTON=f,r.SELECT_WITH_CLICK=f,r)},o)},T=function(e,t){var n=v({},e,{lastEventType:t.type});switch(t.type){case"CHANGE":case"INITIAL_CHANGE":return v({},n,{navigationValue:null,value:t.value});case"NAVIGATE":case"OPEN_WITH_BUTTON":return v({},n,{navigationValue:I(n,t)});case"CLEAR":return v({},n,{value:"",navigationValue:null});case"BLUR":case"ESCAPE":return v({},n,{navigationValue:null});case"SELECT_WITH_CLICK":return v({},n,{value:t.value,navigationValue:null});case"SELECT_WITH_KEYBOARD":return v({},n,{value:e.navigationValue,navigationValue:null});case"CLOSE_WITH_BUTTON":return v({},n,{navigationValue:null});case"INTERACT":return n;case"FOCUS":return v({},n,{navigationValue:I(n,t)});default:return n}};function x(e){return[E,p,C].includes(e)}function I(e,t){return t.value?t.value:t.persistSelection?e.value:null}var A=u.createDescendantContext("ComboboxDescendantContext"),h=i.createNamedContext("ComboboxContext",{}),m=i.createNamedContext("OptionContext",{}),g=i.forwardRefWithAs((function(t,n){var a=t.onSelect,r=t.openOnFocus,o=void 0!==r&&r,l=t.children,s=t.as,f=void 0===s?"div":s,E=t["aria-label"],p=t["aria-labelledby"],C=d(t,["onSelect","openOnFocus","children","as","aria-label","aria-labelledby"]),I=u.useDescendantsInit(),m=I[0],g=I[1],R=e.useRef(),N=e.useRef(),O=e.useRef(),S=e.useRef(),L=e.useRef(),_=function(t,n,a){var r=e.useState(t.initial),o=r[0],i=r[1],u=e.useReducer(n,{value:"",navigationValue:null}),l=u[1];return[o,u[0],function(e,n){void 0===n&&(n={});var a=t.states[o],r=a&&a.on[e];if(r)return l(v({type:e,state:o,nextState:o},n)),void i(r)}]}(b,T),w=_[0],y=_[1],H=_[2];!function(e,t){i.useIsomorphicLayoutEffect((function(){"NAVIGATE"!==e&&"ESCAPE"!==e&&"SELECT_WITH_CLICK"!==e&&"OPEN_WITH_BUTTON"!==e||t.current.focus()}),[t,e])}(y.lastEventType,R);var G=c.useId(C.id),D=G?i.makeId("listbox",G):"listbox",V={ariaLabel:E,ariaLabelledby:p,autocompletePropRef:S,buttonRef:O,comboboxId:G,data:y,inputRef:R,isExpanded:x(w),listboxId:D,onSelect:a||i.noop,openOnFocus:o,persistSelectionRef:L,popoverRef:N,state:w,transition:H};return i.useCheckStyles("combobox"),e.createElement(u.DescendantProvider,{context:A,items:m,set:g},e.createElement(h.Provider,{value:V},e.createElement(f,Object.assign({},C,{"data-reach-combobox":"",ref:n}),i.isFunction(l)?l({id:G,isExpanded:x(w)}):l)))})),R=i.forwardRefWithAs((function(t,n){var a=t.as,r=void 0===a?"input":a,o=t.selectOnClick,u=void 0!==o&&o,l=t.autocomplete,c=void 0===l||l,s=t.onClick,v=t.onChange,f=t.onKeyDown,E=t.onBlur,b=t.onFocus,T=t.value,x=d(t,["as","selectOnClick","autocomplete","onClick","onChange","onKeyDown","onBlur","onFocus","value"]),I=e.useRef(T).current,A=e.useRef(!1);i.useUpdateEffect((function(){A.current=!0}),[T]);var m=e.useContext(h),g=m.data,R=g.navigationValue,N=g.value,O=g.lastEventType,S=m.inputRef,L=m.state,_=m.transition,G=m.listboxId,D=m.autocompletePropRef,V=m.openOnFocus,W=m.isExpanded,k=m.ariaLabel,B=m.ariaLabelledby,U=i.useForkedRef(S,n),P=e.useRef(!1),F=w(),K=y(),j=null!=T;i.useIsomorphicLayoutEffect((function(){D.current=c}),[c,D]);var q=e.useCallback((function(e){""===e.trim()?_("CLEAR"):_(e!==I||A.current?"CHANGE":"INITIAL_CHANGE",{value:e})}),[I,_]);e.useEffect((function(){!j||T===N||""===T.trim()&&""===(N||"").trim()||q(T)}),[T,q,j,N]);var M=!c||L!==p&&L!==C?T||N:R||T||N;return e.createElement(r,Object.assign({"aria-activedescendant":R?String(H(R)):void 0,"aria-autocomplete":"both","aria-controls":G,"aria-expanded":W,"aria-haspopup":"listbox","aria-label":k,"aria-labelledby":k?void 0:B,role:"combobox"},x,{"data-reach-combobox-input":"",ref:U,onBlur:i.wrapEvent(E,K),onChange:i.wrapEvent(v,(function(e){j||q(e.target.value)})),onClick:i.wrapEvent(s,(function(){P.current&&(P.current=!1,S.current.select())})),onFocus:i.wrapEvent(b,(function(){u&&(P.current=!0),V&&"SELECT_WITH_CLICK"!==O&&_("FOCUS")})),onKeyDown:i.wrapEvent(f,F),value:M||""}))})),N=i.forwardRefWithAs((function(t,n){var a=t.as,r=void 0===a?"div":a,o=t.children,u=t.portal,l=void 0===u||u,c=t.onKeyDown,v=t.onBlur,f=t.position,E=void 0===f?s.positionMatchWidth:f,p=d(t,["as","children","portal","onKeyDown","onBlur","position"]),C=e.useContext(h),b=C.inputRef,T=C.isExpanded,x=i.useForkedRef(C.popoverRef,n),I=w(),A=y(),m={"data-reach-combobox-popover":"",onKeyDown:i.wrapEvent(c,I),onBlur:i.wrapEvent(v,A),hidden:!T,tabIndex:-1,children:o};return l?e.createElement(s.Popover,Object.assign({as:r},p,{ref:x,position:E,targetRef:b},m)):e.createElement(r,Object.assign({ref:x},p,m))})),O=i.forwardRefWithAs((function(t,n){var a=t.persistSelection,r=void 0!==a&&a,o=t.as,i=void 0===o?"ul":o,u=d(t,["persistSelection","as"]),l=e.useContext(h),c=l.listboxId;return r&&(l.persistSelectionRef.current=!0),e.createElement(i,Object.assign({role:"listbox"},u,{ref:n,"data-reach-combobox-list":"",id:c}))})),S=i.forwardRefWithAs((function(t,n){var a=t.as,r=void 0===a?"li":a,o=t.children,l=t.value,c=t.onClick,s=d(t,["as","children","value","onClick"]),v=e.useContext(h),f=v.onSelect,E=v.data.navigationValue,p=v.transition,C=e.useRef(null),b=i.useForkedRef(n,C),T=u.useDescendant({element:C.current,value:l},A),x=E===l;return e.createElement(m.Provider,{value:{value:l,index:T}},e.createElement(r,Object.assign({"aria-selected":x,role:"option"},s,{"data-reach-combobox-option":"",ref:b,id:String(H(l)),"data-highlighted":x?"":void 0,tabIndex:-1,onClick:i.wrapEvent(c,(function(){f&&f(l),p("SELECT_WITH_CLICK",{value:l})})),children:o||e.createElement(L,null)})))}));function L(){var t=e.useContext(m).value,n=e.useContext(h).data.value,a=e.useMemo((function(){return l.findAll({searchWords:G(n||"").split(/\s+/),textToHighlight:t})}),[n,t]);return e.createElement(e.Fragment,null,a.length?a.map((function(n,a){var r=t.slice(n.start,n.end);return e.createElement("span",{key:a,"data-user-value":!!n.highlight||void 0,"data-suggested-value":!n.highlight||void 0},r)})):t)}var _=i.forwardRefWithAs((function(t,n){var a=t.as,r=void 0===a?"button":a,o=t.onClick,u=t.onKeyDown,l=d(t,["as","onClick","onKeyDown"]),c=e.useContext(h),s=c.transition,v=c.state,E=c.listboxId,p=c.isExpanded,C=i.useForkedRef(c.buttonRef,n),b=w();return e.createElement(r,Object.assign({"aria-controls":E,"aria-haspopup":"listbox","aria-expanded":p},l,{"data-reach-combobox-button":"",ref:C,onClick:i.wrapEvent(o,(function(){s(v===f?"OPEN_WITH_BUTTON":"CLOSE_WITH_BUTTON")})),onKeyDown:i.wrapEvent(u,b)}))}));function w(){var t=e.useContext(h),n=t.data.navigationValue,a=t.onSelect,r=t.state,o=t.transition,i=t.autocompletePropRef,l=t.persistSelectionRef,c=u.useDescendants(A);return function(e){var t=c.findIndex((function(e){return e.value===n}));function u(){return c[0]}function s(){return c[c.length-1]}switch(e.key){case"ArrowDown":if(e.preventDefault(),!c||!c.length)return;if(r===f)o("NAVIGATE",{persistSelection:l.current});else{var v=t===c.length-1?i.current?null:u():c[(t+1)%c.length];o("NAVIGATE",{value:v?v.value:null})}break;case"ArrowUp":if(e.preventDefault(),!c||0===c.length)return;if(r===f)o("NAVIGATE");else{var d=0===t?i.current?null:s():-1===t?s():c[(t-1+c.length)%c.length];o("NAVIGATE",{value:d?d.value:null})}break;case"Home":case"PageUp":if(e.preventDefault(),!c||0===c.length)return;r===f?o("NAVIGATE"):o("NAVIGATE",{value:u().value});break;case"End":case"PageDown":if(e.preventDefault(),!c||0===c.length)return;r===f?o("NAVIGATE"):o("NAVIGATE",{value:s().value});break;case"Escape":r!==f&&o("ESCAPE");break;case"Enter":r===p&&null!==n&&(e.preventDefault(),a&&a(n),o("SELECT_WITH_KEYBOARD"))}}}function y(){var t=e.useContext(h),n=t.state,a=t.transition,r=t.popoverRef,o=t.inputRef,u=t.buttonRef,l=i.useLazyRef((function(){return new Set}));return e.useEffect((function(){return function(){l.current.forEach((function(e){return cancelAnimationFrame(e)}))}}),[l]),function(){var e=i.getOwnerDocument(r.current);if(e){var t=requestAnimationFrame((function(){e.activeElement!==o.current&&e.activeElement!==u.current&&r.current&&(r.current.contains(e.activeElement)?n!==C&&a("INTERACT"):a("BLUR"))}));l.current.add(t)}}}var H=function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t};function G(e){return String(e).replace(/([.*+?=^!:${}()|[\]/\\])/g,"\\$1")}exports.Combobox=g,exports.ComboboxButton=_,exports.ComboboxInput=R,exports.ComboboxList=O,exports.ComboboxOption=S,exports.ComboboxOptionText=L,exports.ComboboxPopover=N,exports.escapeRegexp=G,exports.useComboboxContext=function(){var t=e.useContext(h),n=t.isExpanded,a=t.comboboxId;return e.useMemo((function(){return{id:a,isExpanded:n}}),[a,n])};
//# sourceMappingURL=combobox.cjs.production.min.js.map
